# Traffic

A project for simulating and analyzing traffic patterns, developed as part of a research paper studying traffic networks with a case study focused on Lahaina during the 2023 Hawaii fires. This codebase enables researchers and practitioners to model, simulate, and analyze the behavior of traffic under various scenarios, including emergency evacuations and disruptions.

The Traffic project is designed to be flexible and extensible, allowing users to model a wide range of road networks and traffic conditions. While the Lahaina case study is a primary focus, the code can be adapted to simulate many types of networks and scenarios.

## Features

- Traffic flow simulation
- Visualization of road networks 
- Customizable parameters describing junction preferences
- Data export for analysis
- Modular experiment phases to study Lahaina

## Experiment Phases

- **Phase 1 experiment:** Simple experiment that simulates baseline traffic conditions on the base network to establish reference metrics for normal network operation.
- **Phase 2 experiment:** Tests the effects of optimizing the junction preferences on Lahaina across several hours.
- **Phase 3 experiment:** Expands on phase 2 by simulating Lahaina for a longer period of time, and tests how different urgencies on source roads affect the overall outcome.

## Getting Started
See [requirements.txt](requirements.txt) for a list of required dependencies.

[phase1_experiment.py](phase1_experiment.py), [phase2_experiment.py](phase2_experiment.py), and [phase3_experiment.py](phase3_experiment.py) can be run to verify our results. These experiments run the networks in various scenarios. The plotting files [plot_ntopt_comparison.py](plot_ntopt_comparison.py), [plot_phase2_ntopt_comparison.py](plot_phase2_ntopt_comparison.py), and [plot_phase3_gamma2_comparison.py](plot_phase3_gamma2_comparison.py) produce the plots in the associated experiments' folders that help visualize the results.

[base_script.py](base_script.py) can be run by itself to obtain a simple animation and picture of the base network run for a very short amount of time.

If you want to apply this code for your own network, you will need the Road, Junction, and Network classes found in [road.py](road.py), [junction.py](junction.py), [network.py](network.py). These are flexible classes allowing you to create a variety of networks. See [am_networks_setup.py](am_networks_setup.py) and [pm_networks_setup.py](pm_networks_setup.py) for examples on how to create your own networks.

Running the network is simple. If your network is stored in a Network object called network, then all you need to do is set the preferences via network.set_preferences(pref) and then call network.evolve_resolve() for as many iterations as you would like. Note that the pref input is optional. Doing network.set_preferences() will use the default preferences. The run_optimization() function in [optimization_script_parallel.py](optimization_script_parallel.py) can be used to find the optimal preferences. See [toy.py](toy/toy.py) for an example of how to build a simple network and how to call the optimization function.

![plot](.\phase1_experiments\gamma_0.0375_ntopt_600\picture.png)

To get the animation and picture creation to work, you will need several files for your network.
- A blank map, e.g. see [blank_map.png](Lahaina_network_info/blank_map.png), to overlay the roads over.
- A label map that maps which pixels correspond to which (labeled) roads, and a list of labels to road names, e.g. see [label_map.npy](Lahaina_network_info/label_map.npy) and [labels_to_road_names.txt](Lahaina_network_info/labels_to_road_names.txt). The map can be generated by using skeletonize from skimage.
- Ratios that define how far a point on a road is from its starting point. These can be generated from the skeleton as well. We use two separate files [pixel_ratios.json](Lahaina_network_info/pixel_ratios.json) and [special_pixel_ratios.json](Lahaina_network_info/special_pixel_ratios.json) to handle some special road objects that occur in our AM networks but not in our PM networks.
- A picture showing where the junctions are, e.g. see [junctions.png](Lahaina_network_info/junctions.png).
- A picture separating the two directions of mostly horizontal roads, e.g. see [left_right.png](Lahaina_network_info/left_right.png). Similarly, a picture separating the two directions of mostly vertical roads, e.g. see [up_down.png](Lahaina_network_info/up_down.png). 

After these files are ready, see [base_script.py](base_script.py) for an example pipeline on how to run the network and create animations and pictures.


